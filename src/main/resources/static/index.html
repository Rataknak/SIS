<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta content="width=device-width, initial-scale=1.0" name="viewport"/>
  <title>SIS Project - Login & Register</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css" rel="stylesheet"/>
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet"/>
  <style>
    body {
      font-family: 'Roboto', sans-serif;
    }
    .register-container {
      display: none;
    }
  </style>
</head>
<body class="bg-gray-100">
<!-- Login Container -->
<div class="login-container min-h-screen flex items-center justify-center py-12 px-4 sm:px-6 lg:px-8">
  <div class="max-w-md w-full bg-white p-8 rounded-lg shadow-md">
    <div class="text-center">
      <img alt="SIS Project Logo" class="mx-auto h-16 w-auto"src="images/logo.png"/>
      <h2 class="mt-6 text-3xl font-extrabold text-gray-900">Sign in to your account</h2>
    </div>
    <form id="loginForm" class="mt-8 space-y-6">
      <div class="rounded-md shadow-sm -space-y-px">
        <div>
          <label class="sr-only" for="email-address">Email address</label>
          <input id="email-address" name="email" type="email" autocomplete="email" required
                 class="appearance-none rounded-t-md relative block w-full px-3 py-2 border border-gray-300 placeholder-gray-500 text-gray-900 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 focus:z-10 sm:text-sm"
                 placeholder="Email address"/>
        </div>
        <div>
          <label class="sr-only" for="password">Password</label>
          <input id="password" name="password" type="password" autocomplete="current-password" required
                 class="appearance-none rounded-b-md relative block w-full px-3 py-2 border border-gray-300 placeholder-gray-500 text-gray-900 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 focus:z-10 sm:text-sm"
                 placeholder="Password"/>
        </div>
      </div>

      <div>
        <button type="submit"
                class="group relative w-full flex justify-center py-2 px-4 border border-transparent text-sm font-medium rounded-md text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">
                        <span class="absolute left-0 inset-y-0 flex items-center pl-3">
                            <i class="fas fa-lock fa-lg text-indigo-500 group-hover:text-indigo-400"></i>
                        </span>
          Sign in
        </button>
      </div>
    </form>
    <div class="text-center mt-6">
      <p class="text-sm text-gray-600">
        Don't have an account?
        <a href="javascript:void(0)" onclick="toggleForms()" class="font-medium text-indigo-600 hover:text-indigo-500">Register</a>
      </p>
    </div>
  </div>
</div>

<!-- Register Container -->
<div class="register-container min-h-screen flex items-center justify-center py-12 px-4 sm:px-6 lg:px-8">
  <div class="max-w-md w-full bg-white p-8 rounded-lg shadow-md">
    <div class="text-center">
      <img alt="SIS Project Logo" class="mx-auto h-16 w-auto"src="images/logo.png"/>
      <h2 class="mt-6 text-3xl font-extrabold text-gray-900">Create your account</h2>
    </div>
    <form id="registerForm" class="mt-8 space-y-6">
      <div class="space-y-4">
        <div>
          <input name="username" type="text" required
                 class="appearance-none rounded-md relative block w-full px-3 py-2 border border-gray-300 placeholder-gray-500 text-gray-900 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm"
                 placeholder="Username"/>
        </div>
        <div>
          <input name="email" type="email" required
                 class="appearance-none rounded-md relative block w-full px-3 py-2 border border-gray-300 placeholder-gray-500 text-gray-900 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm"
                 placeholder="Email"/>
        </div>
        <div>
          <input name="password" type="password" required
                 class="appearance-none rounded-md relative block w-full px-3 py-2 border border-gray-300 placeholder-gray-500 text-gray-900 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm"
                 placeholder="Password"/>
        </div>
        <div>
          <input name="name" type="text" required
                 class="appearance-none rounded-md relative block w-full px-3 py-2 border border-gray-300 placeholder-gray-500 text-gray-900 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm"
                 placeholder="Full Name"/>
        </div>
        <div>
          <input name="dob" type="date" required
                 class="appearance-none rounded-md relative block w-full px-3 py-2 border border-gray-300 text-gray-900 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm"/>
        </div>
        <div>
          <select name="gender" required
                  class="appearance-none rounded-md relative block w-full px-3 py-2 border border-gray-300 text-gray-900 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm">
            <option value="">Select Gender</option>
            <option value="MALE">Male</option>
            <option value="FEMALE">Female</option>
            <option value="OTHER">Other</option>
          </select>
        </div>
        <div>
                        <textarea name="address" required
                                  class="appearance-none rounded-md relative block w-full px-3 py-2 border border-gray-300 placeholder-gray-500 text-gray-900 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm"
                                  placeholder="Address"></textarea>
        </div>
        <div>
          <input name="phone" type="tel" required
                 class="appearance-none rounded-md relative block w-full px-3 py-2 border border-gray-300 placeholder-gray-500 text-gray-900 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm"
                 placeholder="Phone"/>
        </div>
        <div>
          <input name="file" type="file" accept="image/*" required
                 class="appearance-none rounded-md relative block w-full px-3 py-2 border border-gray-300 text-gray-900 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm"/>
          <img id="imagePreview" class="mt-4 max-w-xs mx-auto hidden rounded-md"/>
        </div>
      </div>
      <div>
        <button type="submit"
                class="group relative w-full flex justify-center py-2 px-4 border border-transparent text-sm font-medium rounded-md text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">
                        <span class="absolute left-0 inset-y-0 flex items-center pl-3">
                            <i class="fas fa-user-plus fa-lg text-indigo-500 group-hover:text-indigo-400"></i>
                        </span>
          Register
        </button>
      </div>
    </form>
    <div class="text-center mt-6">
      <p class="text-sm text-gray-600">
        Already have an account?
        <a href="javascript:void(0)" onclick="toggleForms()" class="font-medium text-indigo-600 hover:text-indigo-500">Sign in</a>
      </p>
    </div>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11.10.5/dist/sweetalert2.all.min.js"></script>
<script>
  function toggleForms() {
    const loginContainer = document.querySelector('.login-container');
    const registerContainer = document.querySelector('.register-container');

    if (loginContainer.style.display === 'none') {
      loginContainer.style.display = 'flex';
      registerContainer.style.display = 'none';
    } else {
      loginContainer.style.display = 'none';
      registerContainer.style.display = 'flex';
    }
  }

  // Image preview
  document.querySelector('input[name="file"]').addEventListener('change', function(e) {
    const preview = document.getElementById('imagePreview');
    const file = e.target.files[0];
    if (file) {
      const reader = new FileReader();
      reader.onload = function(e) {
        preview.src = e.target.result;
        preview.classList.remove('hidden');
      }
      reader.readAsDataURL(file);
    }
  });

  // Login form submit
  document.getElementById('loginForm').addEventListener('submit', async function(e) {
    e.preventDefault();
    const loginRequest = {
      email: this.querySelector('input[name="email"]').value,
      password: this.querySelector('input[name="password"]').value
    };

    try {
      const response = await fetch('/auth/login', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
          'Accept': 'application/json'
        },
        body: JSON.stringify(loginRequest)
      });

      const data = await response.json();

      if (response.ok) {
        localStorage.setItem('token', data.token);
        localStorage.setItem('user', JSON.stringify(data.user));

        await Swal.fire({
          icon: 'success',
          title: 'Login Successful',
          text: 'Welcome back!',
          timer: 1500
        });

        window.location.href = '/dashboard.html';
      } else {
        throw new Error(data.message || 'Invalid email or password');
      }
    } catch (error) {
      Swal.fire({
        icon: 'error',
        title: 'Login Failed',
        text: error.message || 'Please check your credentials and try again'
      });
    }
  });

  // Register form submit
  document.getElementById('registerForm').addEventListener('submit', async function(e) {
    e.preventDefault();
    const formData = new FormData();
    const adminRequest = {
      username: this.querySelector('input[name="username"]').value,
      email: this.querySelector('input[name="email"]').value,
      password: this.querySelector('input[name="password"]').value,
      name: this.querySelector('input[name="name"]').value,
      dob: this.querySelector('input[name="dob"]').value,
      gender: this.querySelector('select[name="gender"]').value,
      address: this.querySelector('textarea[name="address"]').value,
      phone: this.querySelector('input[name="phone"]').value
    };

    formData.append('adminRequest', new Blob([JSON.stringify(adminRequest)], {
      type: 'application/json'
    }));
    formData.append('file', this.querySelector('input[name="file"]').files[0]);

    try {
      const response = await fetch('/auth/register', {
        method: 'POST',
        body: formData
      });

      if (response.ok) {
        await Swal.fire({
          icon: 'success',
          title: 'Registration Successful',
          text: 'Please login with your credentials'
        });
        toggleForms();
      } else {
        throw new Error('Registration failed');
      }
    } catch (error) {
      Swal.fire({
        icon: 'error',
        title: 'Registration Failed',
        text: 'Please try again'
      });
    }
  });
</script>
</body>
</html>