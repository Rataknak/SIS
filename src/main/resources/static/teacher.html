<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Manage Teachers</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
  <style>
    body {
      font-family: 'Roboto', sans-serif;
    }
    .sidebar {
      transition: all 0.3s;
    }
  </style>
</head>
<body class="bg-gray-100">
<div class="flex h-screen">
  <!-- Sidebar -->
  <aside class="fixed inset-y-0 left-0 w-72 bg-white shadow-xl rounded-tr-3xl rounded-br-3xl flex flex-col justify-between border border-gray-300">
    <div>
      <div class="flex items-center gap-4 px-8 py-8 border-b border-gray-300">
        <img alt="School Logo, a classic maroon shield with gold trim and an open book in the center" class="w-20 h-20 rounded-lg shadow-md" height="80" src="images/logo.png" width="80"/>
        <h1 class="text-3xl font-bold text-gray-800 select-none tracking-wide">
          RUPP
        </h1>
      </div>
      <nav class="mt-10 flex flex-col space-y-3 px-6">
        <a class="flex items-center gap-4 px-5 py-3 rounded-lg text-gray-700 hover:bg-gray-200 hover:text-gray-900 transition" href="dashboard.html">
          <i class="fas fa-home text-lg"></i>
          <span class="font-semibold text-lg">Dashboard</span>
        </a>
        <a class="flex items-center gap-4 px-5 py-3 rounded-lg text-gray-700 hover:bg-gray-200 hover:text-gray-900 transition" href="student.html">
          <i class="fas fa-users text-lg"></i>
          <span class="font-semibold text-lg">Students</span>
        </a>
        <a class="flex items-center gap-4 px-5 py-3 rounded-lg text-gray-700 hover:bg-gray-200 hover:text-gray-900 transition" href="course.html">
          <i class="fas fa-book text-lg"></i>
          <span class="font-semibold text-lg">Courses</span>
        </a>
        <a aria-current="page" class="flex items-center gap-4 px-5 py-3 rounded-lg bg-gray-800 text-white shadow-lg font-semibold text-lg" href="teacher.html">
          <i class="fas fa-chalkboard-teacher text-lg"></i>
          <span class="font-semibold text-lg">Teachers</span>
        </a>
        <a class="flex items-center gap-4 px-5 py-3 rounded-lg text-gray-700 hover:bg-gray-200 hover:text-gray-900 transition" href="enrollment.html">
          <i class="fas fa-clipboard-list text-lg"></i>
          <span>Enrollments</span>
        </a>
      </nav>
    </div>
    <div class="px-6 py-6 border-t border-gray-300 text-center text-gray-500 text-sm select-none">
      Â© 2025 Royal University of Phnom Penh. All rights reserved.
    </div>
  </aside>

  <!-- Main Content -->
  <div class="flex-1 flex flex-col overflow-hidden ml-72">
    <!-- Top Header -->
    <header class="bg-white shadow-sm z-10">
      <div class="flex items-center justify-between px-6 py-5 border-b border-gray-200">
        <!-- Left Section -->
        <div class="flex items-center space-x-4">
          <h1 class="text-2xl font-bold text-gray-800">Manage Teachers</h1>
          <div class="relative w-64">
            <input type="text" id="searchInput" placeholder="Search teachers..."
                   class="w-full pl-10 pr-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500">
            <i class="fas fa-search absolute left-3 top-3 text-gray-400"></i>
          </div>
        </div>

        <!-- Right Section -->
        <div class="flex items-center space-x-4">
          <div class="relative">
            <select
                    id="subjectHeader"
                    name="subjectHeader"
                    class="block w-full appearance-none bg-gray-50 border border-gray-300 rounded-lg py-2 px-3 text-gray-700 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 text-sm"
            >
              <option value="" disabled selected>Select subject</option>
              <!-- Options will be populated dynamically -->
            </select>
            <div class="absolute inset-y-0 right-0 flex items-center pr-3 pointer-events-none">
              <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-gray-400" viewBox="0 0 20 20" fill="currentColor">
                <path fill-rule="evenodd" d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z" clip-rule="evenodd" />
              </svg>
            </div>
          </div>
          <button id="openRegisterModal" class="px-5 py-2 bg-gray-800 text-white rounded-lg hover:bg-gray-900 transition">
            <i class="fas fa-plus mr-2"></i> Register Teacher
          </button>
        </div>
      </div>
    </header>

    <!-- Search and Action Section -->
    <div class="flex justify-between mb-6">

    </div>

    <!-- Teacher Table -->
    <div class="bg-white rounded-lg shadow overflow-hidden">
      <div class="overflow-y-auto" style="max-height: 650px;">
        <table class="min-w-full divide-y divide-gray-200">
          <thead class="bg-gray-700 text-white">
          <tr>
            <th class="px-6 py-3 text-left text-xs font-medium uppercase tracking-wider">Profile</th>
            <th class="px-6 py-3 text-left text-xs font-medium uppercase tracking-wider">Name</th>
            <th class="px-6 py-3 text-left text-xs font-medium uppercase tracking-wider">Email</th>
            <th class="px-6 py-3 text-left text-xs font-medium uppercase tracking-wider">Gender</th>
            <th class="px-6 py-3 text-left text-xs font-medium uppercase tracking-wider">Phone</th>
            <th class="px-6 py-3 text-left text-xs font-medium uppercase tracking-wider">Date Of Birth</th>
            <th class="px-6 py-3 text-left text-xs font-medium uppercase tracking-wider">Address</th>
            <th class="px-6 py-3 text-left text-xs font-medium uppercase tracking-wider">Subject</th>
          </tr>
          </thead>
          <tbody id="teachersTableBody" class="bg-white divide-y divide-gray-200">
          <!-- Teachers will be loaded here -->
          </tbody>
        </table>
      </div>
    </div>

    <!-- Loading Indicator -->
    <div id="loadingIndicator" class="text-center py-8 hidden">
      <i class="fas fa-spinner fa-spin text-2xl text-indigo-600"></i>
      <p class="mt-2 text-gray-600">Loading teachers...</p>
    </div>

    <!-- No Results Message -->
    <div id="noResults" class="text-center py-8 hidden">
      <i class="fas fa-exclamation-circle text-2xl text-gray-400"></i>
      <p class="mt-2 text-gray-600">No teachers found</p>
    </div>
  </div>
</div>

<!-- Register Teacher Modal -->
<div id="registerModal" class="modal fixed inset-0 bg-gray-800 bg-opacity-50 hidden items-center justify-center p-4 z-50">
  <div class="bg-white rounded-lg shadow-xl w-full max-w-md">
    <div class="flex justify-between items-center border-b px-6 py-4">
      <h2 class="text-xl font-semibold text-indigo-600">Register Teacher</h2>
    </div>
    <form id="registerTeacherForm" class="p-6">
      <div class="mb-4">
        <label for="name" class="block text-sm font-medium text-gray-700 mb-1">Name *</label>
        <input type="text" id="name" name="name" class="w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500" required>
      </div>
      <div class="mb-4">
        <label for="email" class="block text-sm font-medium text-gray-700 mb-1">Email *</label>
        <input type="email" id="email" name="email" class="w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500" required>
      </div>
      <div class="mb-4">
        <label for="gender" class="block text-sm font-medium text-gray-700 mb-1">Gender *</label>
        <select id="gender" name="gender" class="w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500" required>
          <option value="MALE">Male</option>
          <option value="FEMALE">Female</option>
        </select>
      </div>
      <div class="mb-4">
        <label for="phone" class="block text-sm font-medium text-gray-700 mb-1">Phone *</label>
        <input type="text" id="phone" name="phone" class="w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500" required>
      </div>
      <div class="mb-4">
        <label for="dob" class="block text-sm font-medium text-gray-700 mb-1">Date of Birth *</label>
        <input type="date" id="dob" name="dob" class="w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500" required>
      </div>
      <div class="mb-4">
        <label for="address" class="block text-sm font-medium text-gray-700 mb-1">Address *</label>
        <input type="text" id="address" name="address" class="w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500" required>
      </div>
      <div class="mb-4">
        <label for="file" class="block text-sm font-medium text-gray-700 mb-1">Profile Image *</label>
        <div class="mt-1 flex items-center">
          <span class="inline-block h-12 w-12 rounded-full overflow-hidden bg-gray-100 mr-3">
            <img id="profilePreview" src="images/teacher.png" alt="Preview" class="h-full w-full object-cover">
          </span>
          <label class="cursor-pointer">
            <span class="px-4 py-2 bg-indigo-600 text-white rounded-md hover:bg-indigo-700">Upload</span>
            <input type="file" id="file" name="file" class="hidden" accept="image/*" required>
          </label>
        </div>
      </div>
      <div class="flex justify-end space-x-3 pt-4 border-t">
        <button type="button" id="cancelRegister" class="px-4 py-2 border border-gray-300 rounded-md text-gray-700 hover:bg-gray-50">
          Cancel
        </button>
        <button type="submit" class="px-4 py-2 bg-indigo-600 text-white rounded-md hover:bg-indigo-700">
          Register
        </button>
      </div>
    </form>
  </div>
</div>

<!-- Edit Teacher Modal -->
<div id="editModal" class="modal fixed inset-0 bg-gray-800 bg-opacity-50 hidden items-center justify-center p-4 z-50">
  <div class="bg-white rounded-lg shadow-xl w-full max-w-md">
    <div class="flex justify-between items-center border-b px-6 py-4">
      <h2 class="text-xl font-semibold text-indigo-600">Edit Teacher</h2>
    </div>
    <form id="editTeacherForm" class="p-6">
      <input type="hidden" id="editTeacherId">
      <div class="mb-4">
        <label for="editName" class="block text-sm font-medium text-gray-700 mb-1">Name *</label>
        <input type="text" id="editName" name="name" class="w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500" required>
      </div>
      <div class="mb-4">
        <label for="editEmail" class="block text-sm font-medium text-gray-700 mb-1">Email *</label>
        <input type="email" id="editEmail" name="email" class="w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500" required>
      </div>
      <div class="mb-4">
        <label for="editGender" class="block text-sm font-medium text-gray-700 mb-1">Gender *</label>
        <select id="editGender" name="gender" class="w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500" required>
          <option value="MALE">Male</option>
          <option value="FEMALE">Female</option>
        </select>
      </div>
      <div class="mb-4">
        <label for="editPhone" class="block text-sm font-medium text-gray-700 mb-1">Phone *</label>
        <input type="text" id="editPhone" name="phone" class="w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500" required>
      </div>
      <div class="mb-4">
        <label for="editDob" class="block text-sm font-medium text-gray-700 mb-1">Date of Birth *</label>
        <input type="date" id="editDob" name="dob" class="w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500" required>
      </div>
      <div class="mb-4">
        <label for="editAddress" class="block text-sm font-medium text-gray-700 mb-1">Address *</label>
        <input type="text" id="editAddress" name="address" class="w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500" required>
      </div>

      <div class="flex justify-end space-x-3 pt-4 border-t">
        <button type="button" id="cancelEdit" class="px-4 py-2 border border-gray-300 rounded-md text-gray-700 hover:bg-gray-50">
          Cancel
        </button>
        <button type="submit" class="px-4 py-2 bg-indigo-600 text-white rounded-md hover:bg-indigo-700">
          Save Changes
        </button>
      </div>
    </form>
  </div>
</div>

<div id="teacherDetailsModal" class="fixed inset-0 bg-black bg-opacity-60 hidden flex justify-center items-center z-50 p-4">
  <div class="bg-white rounded-xl shadow-2xl w-full max-w-6xl max-h-[90vh] flex flex-col md:flex-row overflow-hidden">
    <!-- Left Side: Teacher Information -->
    <div class="w-full md:w-1/2 p-8 overflow-y-auto">
      <div class="flex justify-between items-start mb-8">
        <div>
          <h2 class="text-3xl font-bold text-gray-800">Teacher Profile</h2>
          <p class="text-indigo-600 font-medium">Detailed Information</p>
        </div>
        <button id="closeTeacherDetailsModal" class="text-gray-400 hover:text-gray-600 transition-transform hover:scale-110">
          <i class="fas fa-times text-2xl"></i>
        </button>
      </div>

      <!-- Profile Picture (Mobile View) -->
      <div class="md:hidden flex justify-center mb-8">
        <div class="relative group">
          <img id="teacherImageMobile" src="static/images/teacher.png" alt="Teacher Image"
               class="w-36 h-36 rounded-full object-cover border-4 border-white shadow-lg ring-2 ring-indigo-200">
          <div class="absolute inset-0 bg-black bg-opacity-30 rounded-full opacity-0 group-hover:opacity-100 transition-opacity flex items-center justify-center">
            <button onclick="teacherManager.showProfileImageModal()" class="text-white bg-indigo-600 p-3 rounded-full">
              <i class="fas fa-camera text-lg"></i>
            </button>
          </div>
        </div>
      </div>

      <!-- Basic Information -->
      <div class="space-y-6">
        <div class="bg-gray-50 p-6 rounded-xl">
          <h3 class="text-xl font-semibold text-gray-800 mb-4 pb-2 border-b border-gray-200">Basic Information</h3>
          <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <div>
              <label class="block text-sm font-medium text-gray-500 mb-1">Full Name</label>
              <p id="teacherName" class="text-lg font-semibold text-gray-800"></p>
            </div>
            <div>
              <label class="block text-sm font-medium text-gray-500 mb-1">Email</label>
              <p id="teacherEmail" class="text-lg font-semibold text-gray-800 break-all"></p>
            </div>
          </div>
        </div>

        <!-- Personal Information Section -->
        <div class="bg-gray-50 p-6 rounded-xl">
          <h3 class="text-xl font-semibold text-gray-800 mb-4 pb-2 border-b border-gray-200">Personal Information</h3>
          <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <div>
              <label class="block text-sm font-medium text-gray-500 mb-1">Date of Birth</label>
              <p id="teacherDob" class="text-gray-800 font-medium"></p>
            </div>
            <div>
              <label class="block text-sm font-medium text-gray-500 mb-1">Gender</label>
              <p id="teacherGender" class="text-gray-800 font-medium"></p>
            </div>
            <div class="md:col-span-2">
              <label class="block text-sm font-medium text-gray-500 mb-1">Address</label>
              <p id="teacherAddress" class="text-gray-800 font-medium"></p>
            </div>
            <div>
              <label class="block text-sm font-medium text-gray-500 mb-1">Phone Number</label>
              <p id="teacherPhone" class="text-gray-800 font-medium"></p>
            </div>
          </div>
        </div>
      </div>

      <!-- Action Buttons -->
      <div class="mt-8 flex flex-wrap gap-4">
        <button id="assignToCourseButton"
                class="px-6 py-3 bg-gradient-to-r from-green-500 to-green-600 text-white rounded-xl hover:from-green-600 hover:to-green-700 transition-all shadow-md hover:shadow-lg flex items-center">
          <i class="fas fa-book-medical mr-2"></i>
          Assign to Subject
        </button>
        <button id="editTeacherButton"
                class="px-6 py-3 bg-gradient-to-r from-blue-500 to-blue-600 text-white rounded-xl hover:from-blue-600 hover:to-blue-700 transition-all shadow-md hover:shadow-lg flex items-center">
          <i class="fas fa-edit mr-2"></i>
          Edit Profile
        </button>
        <button id="deactivateTeacherButton"
                class="px-6 py-3 bg-gradient-to-r from-red-500 to-red-600 text-white rounded-xl hover:from-red-600 hover:to-red-700 transition-all shadow-md hover:shadow-lg flex items-center">
          <i class="fas fa-user-slash mr-2"></i>
          Deactivate
        </button>
      </div>
    </div>

    <!-- Right Side: Teacher Image (Desktop) -->
    <div class="hidden md:flex md:w-1/2 bg-gradient-to-br from-indigo-50 to-gray-100 items-center justify-center p-8 relative">
      <div class="relative group w-full h-full flex items-center justify-center">
        <img id="teacherImage" src="images/teacher.png" alt="Teacher Image"
             class="max-w-full max-h-[70vh] object-contain rounded-lg shadow-xl ring-4 ring-white transform group-hover:scale-105 transition-transform duration-300">
        <button id="editProfileImageButton"
                class="absolute bottom-6 right-6 p-4 bg-white rounded-full shadow-lg hover:bg-gray-100 transition-all transform hover:scale-110">
          <i class="fas fa-camera text-indigo-600 text-xl"></i>
        </button>
      </div>
    </div>
  </div>
</div>

<div id="viewProfileImageModal" class="fixed inset-0 bg-black bg-opacity-70 hidden flex items-center justify-center z-50 p-4">
  <div class="bg-white rounded-2xl shadow-2xl w-full max-w-md overflow-hidden">
    <!-- Modal Header -->
    <div class="px-6 py-5 border-b border-gray-100 flex justify-between items-center bg-gradient-to-r from-indigo-50 to-gray-50">
      <h2 class="text-2xl font-bold text-gray-800">Update Profile Image</h2>
    </div>

    <!-- Modal Body -->
    <div class="p-6">
      <!-- Current Profile Image -->
      <div class="flex justify-center mb-6">
        <div class="relative group">
          <img id="profileImageLarge" src="" alt="Profile Image"
               class="w-48 h-48 rounded-full object-cover border-4 border-white shadow-lg ring-2 ring-indigo-100">
          <div class="absolute inset-0 bg-black bg-opacity-30 rounded-full opacity-0 group-hover:opacity-100 transition-opacity flex items-center justify-center">
            <span class="text-white font-medium">Current Photo</span>
          </div>
        </div>
      </div>

      <!-- Upload Form -->
      <form id="updateTeacherProfileForm" enctype="multipart/form-data">
        <div class="mb-6">
          <label for="updateFile" class="block text-sm font-medium text-gray-700 mb-2">Choose new image</label>
          <div class="mt-1 flex justify-center px-6 pt-5 pb-6 border-2 border-gray-300 border-dashed rounded-xl">
            <div class="space-y-1 text-center">
              <div class="flex text-sm text-gray-600 justify-center">
                <label for="updateFile" class="relative cursor-pointer bg-white rounded-md font-medium text-indigo-600 hover:text-indigo-500 focus-within:outline-none">
                  <span>Upload a file</span>
                  <input id="updateFile" name="file" type="file" class="sr-only" accept="image/*" required>
                </label>
                <p class="pl-1">or drag and drop</p>
              </div>
              <p class="text-xs text-gray-500">PNG, JPG, GIF up to 5MB</p>
            </div>
          </div>
        </div>

        <!-- Action Buttons -->
        <div class="flex justify-end space-x-3 pt-4 border-t border-gray-100">
          <button type="button" id="closeViewProfileImageModalButton"
                  class="px-5 py-2.5 text-sm font-medium text-gray-700 bg-gray-100 rounded-lg hover:bg-gray-200 transition-colors">
            Cancel
          </button>
          <button type="submit"
                  class="px-5 py-2.5 text-sm font-medium text-white bg-indigo-600 rounded-lg hover:bg-indigo-700 transition-colors shadow-sm hover:shadow-md">
            Update Profile
          </button>
        </div>
      </form>
    </div>
  </div>
</div>

<!-- Assign Course Modal -->
<div id="showAssignSubjectModal" class="fixed inset-0 bg-black bg-opacity-60 hidden flex items-center justify-center p-4 z-50">
  <div class="bg-white rounded-xl shadow-2xl w-full max-w-lg">
    <!-- Modal Header -->
    <div class="flex justify-between items-center px-6 py-4 border-b border-gray-200">
      <h2 class="text-2xl font-bold text-gray-800">Assign Subject</h2>
      <button id="closeAssignCourseModal" class="text-gray-400 hover:text-gray-600 transition">
        <i class="fas fa-times text-lg"></i>
      </button>
    </div>

    <!-- Modal Body -->
    <form id="assignCourseForm" class="px-6 py-6 space-y-6">
      <!-- Hidden Input for Teacher ID -->
      <input type="hidden" id="assignTeacherId">

      <div class="relative">
        <label for="subjectSelect" class="block text-sm font-medium text-gray-700 mb-2">Select Subject *</label>
        <div class="relative">
          <select id="subjectSelect" name="subjectIdId" class="w-full px-4 py-3 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 appearance-none">
            <option value="" disabled selected>Select a Subject</option>
            <!-- Options will be populated dynamically -->
          </select>
          <div class="absolute inset-y-0 right-0 flex items-center pr-3 pointer-events-none">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-gray-400" viewBox="0 0 20 20" fill="currentColor">
              <path fill-rule="evenodd" d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z" clip-rule="evenodd" />
            </svg>
          </div>
        </div>
      </div>
    </form>

    <!-- Modal Footer -->
    <div class="flex justify-end items-center px-6 py-4 border-t border-gray-200 space-x-4">
      <button type="button" id="cancelAssignCourse" class="px-5 py-2 text-sm font-medium text-gray-700 bg-gray-100 rounded-lg hover:bg-gray-200 transition">
        Cancel
      </button>
      <button type="submit" form="assignCourseForm" class="px-5 py-2 text-sm font-medium text-white bg-indigo-600 rounded-lg hover:bg-indigo-700 transition">
        Assign Course
      </button>
    </div>
  </div>
</div>

<!-- Confirmation Modal -->
<div id="confirmModal" class="modal fixed inset-0 bg-gray-800 bg-opacity-50 hidden items-center justify-center p-4 z-50">
  <div class="bg-white rounded-lg shadow-xl w-full max-w-sm">
    <div class="p-6 text-center">
      <i class="fas fa-exclamation-circle text-4xl text-yellow-500 mb-4"></i>
      <h3 class="text-lg font-medium text-gray-900 mb-2" id="confirmTitle">Are you sure?</h3>
      <p class="text-sm text-gray-500 mb-6" id="confirmMessage">This action cannot be undone.</p>
      <div class="flex justify-center space-x-4">
        <button id="confirmCancel" class="px-4 py-2 border border-gray-300 rounded-md text-gray-700 hover:bg-gray-50 w-24">
          Cancel
        </button>
        <button id="confirmAction" class="px-4 py-2 bg-red-600 text-white rounded-md hover:bg-red-700 w-24">
          Confirm
        </button>
      </div>
    </div>
  </div>
</div>
<!-- Add this before closing body tag -->
<script src="https://cdn.jsdelivr.net/npm/browser-image-compression@2.0.2/dist/browser-image-compression.js"></script>
<script>

  document.addEventListener('DOMContentLoaded', () => {
    const subjectHeader = document.getElementById('subjectHeader');
    const teachersTableBody = document.getElementById('teachersTableBody');
    const loadingIndicator = document.getElementById('loadingIndicator');
    const noResults = document.getElementById('noResults');

    subjectHeader.addEventListener('change', async () => {
      const subjectId = subjectHeader.value;

      if (!subjectId) {
        alert('Please select a subject.');
        return;
      }

      // Show loading indicator
      loadingIndicator.classList.remove('hidden');
      teachersTableBody.classList.add('hidden');
      noResults.classList.add('hidden');

      try {
        const response = await fetch(`/api/admin/teachers/bySubject/${subjectId}`);
        if (!response.ok) throw new Error('Failed to fetch teachers');

        const teachers = await response.json();

        // Clear the table body
        teachersTableBody.innerHTML = '';

        if (teachers.length === 0) {
          noResults.classList.remove('hidden');
        } else {
          teachers.forEach((teacher) => {
            const row = document.createElement('tr');
            row.className = 'hover:bg-gray-50 cursor-pointer';
            row.innerHTML = `
              <td class="px-6 py-4"><img class="h-10 w-10 rounded-full" src="${teacher.profilePicture || 'static/images/teacher.png'}" alt="${teacher.name}"></td>
              <td class="px-6 py-4">${teacher.name}</td>
              <td class="px-6 py-4">${teacher.email}</td>
              <td class="px-6 py-4">${teacher.gender}</td>
              <td class="px-6 py-4">${teacher.phone}</td>
              <td class="px-6 py-4">${teacher.dob || 'N/A'}</td>
              <td class="px-6 py-4">${teacher.address || 'N/A'}</td>
              <td class="px-6 py-4 text-green-600">${teacher.subjectName || 'N/A'}</td>
            `;
            teachersTableBody.appendChild(row);
          });
        }
      } catch (error) {
        console.error('Error fetching teachers:', error);
        alert('Failed to load teachers.');
      } finally {
        // Hide loading indicator
        loadingIndicator.classList.add('hidden');
        teachersTableBody.classList.remove('hidden');
      }
    });
  });
  class ImageUploader {
    async compressImage(file) {
      const options = {
        maxSizeMB: 1,
        maxWidthOrHeight: 1024,
        useWebWorker: true
      };

      try {
        return await imageCompression(file, options);
      } catch (error) {
        console.error('Compression failed:', error);
        return file;
      }
    }

    async uploadWithProgress(file, onProgress) {
      const compressedFile = await this.compressImage(file);
      const formData = new FormData();
      formData.append('file', compressedFile);

      const xhr = new XMLHttpRequest();

      xhr.upload.onprogress = (e) => {
        if (e.lengthComputable) {
          const progress = (e.loaded / e.total) * 100;
          onProgress(progress);
        }
      };

      return new Promise((resolve, reject) => {
        xhr.onload = () => resolve(xhr.response);
        xhr.onerror = () => reject(xhr.statusText);
        xhr.open('POST', '/api/upload');
        xhr.send(formData);
      });
    }
  }
  class TeacherManager {
    constructor() {
      this.state = {
        teachers: [],
        selectedTeacher: null,
      };
      this.init();
    }

    init() {
      this.cacheElements();
      this.bindEvents();
      this.fetchTeachers();
      this.fetchAndPopulateHeaderSubjects();
    }

    cacheElements() {
      this.elements = {
        assignCourseModal: document.getElementById('assignCourseModal'),
        teachersTableBody: document.getElementById('teachersTableBody'),
        loadingIndicator: document.getElementById('loadingIndicator'),
        noResults: document.getElementById('noResults'),
        registerModal: document.getElementById('registerModal'),
        editModal: document.getElementById('editModal'),
        teacherDetailsModal: document.getElementById('teacherDetailsModal'),
        confirmModal: document.getElementById('confirmModal'),
        viewProfileImageModal: document.getElementById('viewProfileImageModal'),
        profileImageLarge: document.getElementById('profileImageLarge'),
        updateTeacherProfileForm: document.getElementById('updateTeacherProfileForm'),
        updateFile: document.getElementById('updateFile'),
        closeViewProfileImageModalButton: document.getElementById('closeViewProfileImageModalButton'),
        teacherImage: document.getElementById('teacherImage') // Added this line
      };
    }

    async fetchTop10Subjects() {
      try {
        const response = await fetch('/api/subject/top10');
        if (!response.ok) throw new Error('Failed to fetch subjects');
        const subjects = await response.json();

        const subjectSelect = document.getElementById('subjectSelect');
        subjectSelect.innerHTML = '<option value="" disabled selected>Select a Subject</option>';
        subjects.forEach(subject => {
          const option = document.createElement('option');
          option.value = subject.id;
          option.textContent = subject.name;
          subjectSelect.appendChild(option);
        });
      } catch (error) {
        console.error('Error fetching subjects:', error);
        alert('Failed to load subjects.');
      }
    }

    async fetchAndPopulateHeaderSubjects() {
      try {
        const response = await fetch('/api/subject/top10');
        if (!response.ok) throw new Error('Failed to fetch subjects');
        const subjects = await response.json();

        const subjectHeaderSelect = document.getElementById('subjectHeader');
        subjectHeaderSelect.innerHTML = '<option value="" disabled selected>Select a subject</option>';

        subjects.forEach(subject => {
          const option = document.createElement('option');
          option.value = subject.id;
          option.textContent = subject.name;
          subjectHeaderSelect.appendChild(option);
        });
      } catch (error) {
        console.error('Error fetching subjects:', error);
      }
    }

    async assignSubjectToTeacher() {
      const subjectSelect = document.getElementById('subjectSelect');
      const selectedSubjectId = subjectSelect.value;

      if (!selectedSubjectId) {
        alert('Please select a subject.');
        return;
      }

      const teacherId = this.state.selectedTeacher?.id;
      if (!teacherId) {
        alert('No teacher selected.');
        return;
      }

      try {
        const response = await fetch(`/api/subject/${selectedSubjectId}/assignTeacher/${teacherId}`, {
          method: 'POST',
        });

        if (!response.ok) {
          const errorMessage = await response.text();
          throw new Error(errorMessage || 'Failed to assign subject to teacher.');
        }

        alert('Subject assigned to teacher successfully!');
        document.getElementById('showAssignSubjectModal').classList.add('hidden'); // Close the modal
      } catch (error) {
        console.error('Error:', error.message);
        alert('Error assigning subject: ' + error.message);
      }
    }

    bindEvents() {
      document.addEventListener('click', (e) => this.handleGlobalClick(e));
      document.addEventListener('submit', (e) => this.handleFormSubmit(e));
      document.getElementById('editProfileImageButton')?.addEventListener('click', (e) => {
        e.preventDefault();
        this.showProfileImageModal();
      });
      document.querySelector('[onclick="teacherManager.showProfileImageModal()"]')?.addEventListener('click', (e) => {
        e.preventDefault();
        this.showProfileImageModal();
      });
      document.getElementById('assignToCourseButton').addEventListener('click', () => {
        const assignSubjectModal = document.getElementById('showAssignSubjectModal');
        assignSubjectModal.classList.remove('hidden'); // Show the modal
      });
      document.getElementById('cancelAssignCourse').addEventListener('click', () => {
        this.closeModal(this.elements.assignCourseModal);
      });
      document.querySelector('[onclick="teacherManager.showProfileImageModal()"]')
              .addEventListener('click', (e) => {
                e.preventDefault();
                this.showProfileImageModal();
              });

      document.getElementById('assignToCourseButton').addEventListener('click', () => {
        this.fetchTop10Subjects(); // Populate the dropdown
        document.getElementById('showAssignSubjectModal').classList.remove('hidden'); // Show the modal
      });

      document.getElementById('assignCourseForm').addEventListener('submit', (e) => {
        e.preventDefault();
        this.assignSubjectToTeacher();
      });

      document.getElementById('cancelAssignCourse').addEventListener('click', () => {
        document.getElementById('showAssignSubjectModal').classList.add('hidden'); // Close the modal
      });

      // File preview handler for register modal
      document.getElementById('file').addEventListener('change', function(event) {
        const file = event.target.files[0];
        if (file) {
          const reader = new FileReader();
          reader.onload = function(e) {
            document.getElementById('profilePreview').src = e.target.result;
          };
          reader.readAsDataURL(file);
        }
      });

      // File preview handler for update modal
      this.elements.updateFile.addEventListener('change', (event) => {
        const file = event.target.files[0];
        if (file) {
          const reader = new FileReader();
          reader.onload = (e) => {
            this.elements.profileImageLarge.src = e.target.result;
          };
          reader.readAsDataURL(file);
        }
      });

      // Update profile image form submission
      this.elements.updateTeacherProfileForm.addEventListener('submit', async (e) => {
        e.preventDefault();
        await this.updateTeacherProfileImage();
      });

      // Close profile image modal button
      this.elements.closeViewProfileImageModalButton.addEventListener('click', () => {
        this.closeModal(this.elements.viewProfileImageModal);
      });

      document.getElementById('cancelRegister').addEventListener('click', () => {
        this.closeModal(this.elements.registerModal);
      });
    }


    async updateTeacherProfileImage() {
      if (!this.state.selectedTeacher) {
        this.showError('No teacher selected');
        return;
      }

      const formData = new FormData(this.elements.updateTeacherProfileForm);
      const teacherId = this.state.selectedTeacher.id;

      try {
        const response = await fetch(`/api/admin/updateTeacherProfileImage/${teacherId}`, {
          method: 'PUT',
          headers: {
            'Authorization': `Bearer ${localStorage.getItem('token')}`
          },
          body: formData
        });

        if (!response.ok) {
          const error = await response.json();
          throw new Error(error.message || 'Failed to update profile image');
        }

        this.showSuccess('Profile image updated successfully!');
        this.closeModal(this.elements.viewProfileImageModal);
        await this.fetchTeachers();
      } catch (error) {
        console.error('Update profile error:', error);
        this.showError(error.message || 'Failed to update profile image');
      }
    }



    showProfileImageModal() {
      if (!this.state.selectedTeacher) {
        this.showError('No teacher selected');
        return;
      }

      // Set current profile image
      this.elements.profileImageLarge.src =
              this.state.selectedTeacher.profilePicture || 'static/images/teacher.png';

      // Reset file input
      this.elements.updateTeacherProfileForm.reset();

      // Close teacher details modal and open profile image modal
      this.closeModal(this.elements.teacherDetailsModal);
      this.openModal(this.elements.viewProfileImageModal);
    }

    // Handle global click events
    handleGlobalClick(e) {
      const { target } = e;

      if (target.matches('#cancelEdit')) {
        this.closeModal(this.elements.editModal);
      }

      if (target.matches('#closeTeacherDetailsModal') || target.closest('#closeTeacherDetailsModal')) {
        this.closeModal(this.elements.teacherDetailsModal);
      }

      if (target.matches('#openRegisterModal')) this.openModal(this.elements.registerModal);
      if (target.matches('#closeRegisterModal')) this.closeModal(this.elements.registerModal);
      if (target.matches('#closeEditModal')) this.closeModal(this.elements.editModal);
      if (target.matches('#closeTeacherDetailsModal')) this.closeModal(this.elements.teacherDetailsModal);
      if (target.matches('#confirmCancel')) this.closeModal(this.elements.confirmModal);
      if (target.matches('#editTeacherButton')) this.openEditModal();
      if (target.matches('#deactivateTeacherButton')) this.confirmDeactivation();
    }



    async handleFormSubmit(e) {
      e.preventDefault();
      const { target } = e;

      if (target.matches('#registerTeacherForm')) {
        const formData = new FormData(target);

        // Add the teacherRequest part as a JSON string
        const teacherRequest = {
          name: document.getElementById('name').value,
          email: document.getElementById('email').value,
          gender: document.getElementById('gender').value,
          phone: document.getElementById('phone').value,
          dob: document.getElementById('dob').value,
          address: document.getElementById('address').value,
        };
        formData.append('teacherRequest', JSON.stringify(teacherRequest));

        // Ensure the file is included in the FormData
        const fileInput = document.getElementById('file');
        if (fileInput.files.length > 0) {
          formData.append('file', fileInput.files[0]);
        }

        await this.registerTeacher(formData);
      }


      if (target.matches('#editTeacherForm')) {
        const formData = {
          id: document.getElementById('editTeacherId').value,
          name: document.getElementById('editName').value,
          email: document.getElementById('editEmail').value,
          gender: document.getElementById('editGender').value,
          phone: document.getElementById('editPhone').value,
          dob: document.getElementById('editDob').value,
          address: document.getElementById('editAddress').value,
        };

        try {
          const response = await fetch(`/api/admin/updateTeacher/${formData.id}`, {
            method: 'PUT',
            headers: {
              'Content-Type': 'application/json',
            },
            body: JSON.stringify(formData),
          });

          if (!response.ok) throw new Error('Failed to update teacher');
          this.showSuccess('Teacher updated successfully!');
          this.closeModal(this.elements.editModal);
          this.fetchTeachers();
        } catch (error) {
          this.showError(error.message);
        }
      }
    }

    // Fetch teachers from the server
    async fetchTeachers() {
      this.toggleLoading(true);
      try {
        const response = await fetch('/api/admin/teachers');
        if (!response.ok) throw new Error('Failed to fetch teachers');
        this.state.teachers = await response.json();
        this.renderTeachers();
      } catch (error) {
        console.error(error);
        this.showError('Failed to load teachers.');
      } finally {
        this.toggleLoading(false);
      }
    }

    async registerTeacher() {
      try {
        const formData = new FormData();
        const form = document.getElementById('registerTeacherForm');

        // Get form values
        const teacherRequest = {
          name: form.querySelector('#name').value,
          email: form.querySelector('#email').value,
          gender: form.querySelector('#gender').value,
          phone: form.querySelector('#phone').value,
          dob: form.querySelector('#dob').value,
          address: form.querySelector('#address').value
        };

        // Add teacher data as JSON
        formData.append('teacherRequest', new Blob([JSON.stringify(teacherRequest)], {
          type: 'application/json'
        }));

        // Add profile image if selected
        const fileInput = document.getElementById('file');
        if (fileInput.files.length > 0) {
          formData.append('file', fileInput.files[0]);
        }

        // Send request
        const response = await fetch('/api/admin/registerTeacher', {
          method: 'POST',
          body: formData
        });

        if (!response.ok) {
          const errorData = await response.json();
          throw new Error(errorData.message || 'Registration failed');
        }

        alert('Teacher registered successfully!');
        this.closeModal(this.elements.registerModal);
      } catch (error) {
        alert(error.message || 'Error registering teacher');
        console.error('Registration error:', error);
      }
    }

    // Render teachers in the table
    renderTeachers() {
      const { teachersTableBody, noResults } = this.elements;
      teachersTableBody.innerHTML = '';

      if (this.state.teachers.length === 0) {
        noResults.classList.remove('hidden');
        return;
      }

      noResults.classList.add('hidden');
      this.state.teachers.forEach((teacher) => {
        const isAssigned = teacher.subjectName;
        const row = document.createElement('tr');
        row.className = 'hover:bg-gray-50 cursor-pointer';
        row.innerHTML = `
      <td class="px-6 py-4"><img class="h-10 w-10 rounded-full" src="${teacher.profilePicture || 'static/images/teacher.png'}" alt="${teacher.name}"></td>
      <td class="px-6 py-4">${teacher.name}</td>
      <td class="px-6 py-4">${teacher.email}</td>
      <td class="px-6 py-4">${teacher.gender}</td>
      <td class="px-6 py-4">${teacher.phone}</td>
      <td class="px-6 py-4">${teacher.dob || 'N/A'}</td>
      <td class="px-6 py-4">${teacher.address || 'N/A'}</td>
      <td class="px-6 py-4 ${isAssigned ? 'text-green-600' : 'text-red-600'}">
        ${isAssigned ? teacher.subjectName : 'Not Assigned'}
      </td>
    `;
        row.addEventListener('click', () => this.showTeacherDetails(teacher));
        teachersTableBody.appendChild(row);
      });
    }

    // Show teacher details in the modal
    showTeacherDetails(teacher) {
      this.state.selectedTeacher = teacher;
      const { teacherDetailsModal } = this.elements;
      teacherDetailsModal.querySelector('#teacherName').textContent = teacher.name || 'N/A';
      teacherDetailsModal.querySelector('#teacherEmail').textContent = teacher.email || 'N/A';
      teacherDetailsModal.querySelector('#teacherDob').textContent = teacher.dob || 'N/A';
      teacherDetailsModal.querySelector('#teacherGender').textContent = teacher.gender || 'N/A';
      teacherDetailsModal.querySelector('#teacherAddress').textContent = teacher.address || 'N/A';
      teacherDetailsModal.querySelector('#teacherPhone').textContent = teacher.phone || 'N/A';
      teacherDetailsModal.querySelector('#teacherImage').src = teacher.profilePicture || 'static/images/teacher.png';
      this.openModal(teacherDetailsModal);
    }

    // Open the "Edit Teacher" modal
    openEditModal() {
      const { selectedTeacher, teacherDetailsModal, editModal } = this.elements;

      if (!this.state.selectedTeacher) {
        this.showError('No teacher selected');
        return;
      }

      // Close the "Details" modal
      this.closeModal(teacherDetailsModal);

      // Populate the "Edit Teacher" modal fields
      document.getElementById('editTeacherId').value = this.state.selectedTeacher.id;
      document.getElementById('editName').value = this.state.selectedTeacher.name || '';
      document.getElementById('editEmail').value = this.state.selectedTeacher.email || '';
      document.getElementById('editGender').value = this.state.selectedTeacher.gender || '';
      document.getElementById('editPhone').value = this.state.selectedTeacher.phone || '';
      document.getElementById('editDob').value = this.state.selectedTeacher.dob || '';
      document.getElementById('editAddress').value = this.state.selectedTeacher.address || '';

      // Open the "Edit Teacher" modal
      this.openModal(editModal);
    }

    // Confirm teacher deactivation
    confirmDeactivation() {
      const { selectedTeacher } = this.state;
      if (!selectedTeacher) return this.showError('No teacher selected');
      const { confirmModal } = this.elements;
      confirmModal.querySelector('#confirmTitle').textContent = 'Deactivate Teacher';
      confirmModal.querySelector('#confirmMessage').textContent = `Are you sure you want to deactivate ${selectedTeacher.name}?`;
      confirmModal.querySelector('#confirmAction').onclick = async () => {
        try {
          await this.deactivateTeacher(selectedTeacher.id);
          this.showSuccess('Teacher deactivated successfully!');
          this.closeModal(confirmModal);
          this.fetchTeachers();
        } catch (error) {
          this.showError(error.message);
        }
      };
      this.openModal(confirmModal);
    }

    // Deactivate a teacher
    async deactivateTeacher(teacherId) {
      const response = await fetch(`/api/admin/deActivateTeacher/${teacherId}`, { method: 'PUT' });
      if (!response.ok) throw new Error('Failed to deactivate teacher');
    }

    // Open a modal
    openModal(modal) {
      modal.classList.remove('hidden');
    }

    // Close a modal
    closeModal(modal) {
      modal.classList.add('hidden');
    }

    // Toggle loading indicator
    toggleLoading(show) {
      this.elements.loadingIndicator.classList.toggle('hidden', !show);
      this.elements.teachersTableBody.classList.toggle('hidden', show);
    }

    // Show success message
    showSuccess(message) {
      alert(message); // Replace with your preferred notification system
    }

    showError(message) {
      alert(message); // Replace with your preferred notification system
    }

  }


  // Initialize the application
  document.addEventListener('DOMContentLoaded', () => new TeacherManager());
</script>
</body>
</html>
